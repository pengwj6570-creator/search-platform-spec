# è‡ªåŠ¨åŒ–æµ‹è¯•æŒ‡å—

> æœ¬æ–‡æ¡£è®°å½•ä¼ä¸šæœç´¢ä¸­å°çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ³•ï¼Œä¾› AI åŠ©æ‰‹è‡ªåŠ¨æ‰§è¡Œæµ‹è¯•éªŒè¯ä½¿ç”¨ã€‚

---

## ğŸ“‹ æµ‹è¯•è„šæœ¬æ¸…å•

| è„šæœ¬ | è·¯å¾„ | ç”¨é€” |
|------|------|------|
| å®Œæ•´éƒ¨ç½²è„šæœ¬ | `deployments/full-deploy.sh` | ä¸€é”®å®Œæˆ SSH é…ç½® + ç¯å¢ƒæ£€æŸ¥ + éƒ¨ç½² |
| é›†æˆæµ‹è¯•è„šæœ¬ | `deployments/run-integration-tests.sh` | è‡ªåŠ¨åŒ–é›†æˆæµ‹è¯• |
| ç¯å¢ƒæ£€æŸ¥è„šæœ¬ | `deployments/check-remote.sh` | æœåŠ¡å™¨ç¯å¢ƒæ£€æŸ¥ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®éƒ¨ç½² + æµ‹è¯•

```bash
cd D:/dev/claudecode/search-platform-spec/deployments

# 1. å®Œæ•´éƒ¨ç½²ï¼ˆé¦–æ¬¡éœ€è¦è¾“å…¥ä¸€æ¬¡å¯†ç ï¼‰
bash full-deploy.sh ubuntu@129.226.60.225

# 2. è¿è¡Œé›†æˆæµ‹è¯•
bash run-integration-tests.sh ubuntu@129.226.60.225
```

---

## ğŸ“ æµ‹è¯•è¦†ç›–èŒƒå›´

### ç¬¬ä¸€ç»„ï¼šåŸºç¡€è®¾æ–½å¥åº·æ£€æŸ¥

| æµ‹è¯•é¡¹ | æ£€æŸ¥å†…å®¹ | éªŒè¯æ–¹æ³• |
|--------|---------|---------|
| SSH è¿æ¥ | SSH å¯†é’¥è®¤è¯æ˜¯å¦å·¥ä½œ | è¿œç¨‹æ‰§è¡Œ `echo OK` |
| Docker | Docker æ˜¯å¦è¿è¡Œ | `docker --version` |
| OpenSearch | ES é›†ç¾¤çŠ¶æ€ | HTTP `/_cluster/health` |
| Kafka | Kafka æ˜¯å¦ç›‘å¬ç«¯å£ | `ss -tuln \| grep :9092` |

### ç¬¬äºŒç»„ï¼šåº”ç”¨æœåŠ¡å¥åº·æ£€æŸ¥

| æœåŠ¡ | ç«¯ç‚¹ | é¢„æœŸå“åº” |
|------|------|---------|
| Config Admin | `:8080/actuator/health` | `{"status":"UP"}` |
| Query Service | `:8082/actuator/health` | `{"status":"UP"}` |
| Vector Service | `:8083/actuator/health` | `{"status":"UP"}` |
| API Gateway | `:8084/actuator/health` | `{"status":"UP"}` |
| Prometheus | `:9090/-/healthy` | Prometheus |
| Grafana | `:3000/api/health` | `{"database":"ok"}` |

### ç¬¬ä¸‰ç»„ï¼šAPI åŠŸèƒ½æµ‹è¯•

| API | ç«¯ç‚¹ | éªŒè¯å†…å®¹ |
|-----|------|---------|
| OpenSearch | `:9200/_cat/indices` | ç´¢å¼•åˆ—è¡¨ API |
| Kafka | (docker exec) | Topic åˆ—è¡¨ |
| Config Admin | `:8080/api/v1/sources` | Sources API |
| Config Admin | `:8080/api/v1/objects` | Objects API |

### ç¬¬å››ç»„ï¼šå®¹å™¨çŠ¶æ€æ£€æŸ¥

éªŒè¯ä»¥ä¸‹å®¹å™¨æ˜¯å¦è¿è¡Œï¼š

- `opensearch-node1`
- `opensearch-node2`
- `kafka`
- `zookeeper`
- `config-admin`
- `query-service`
- `data-sync`
- `vector-service`
- `api-gateway`
- `prometheus`
- `grafana`

### ç¬¬äº”ç»„ï¼šèµ„æºä½¿ç”¨æ£€æŸ¥

- CPU æ ¸å¿ƒæ•°
- å†…å­˜ä½¿ç”¨é‡
- ç£ç›˜ä½¿ç”¨é‡
- å„å®¹å™¨ CPU/å†…å­˜å ç”¨

### ç¬¬å…­ç»„ï¼šæ—¥å¿—é‡‡æ ·

æ£€æŸ¥å„æœåŠ¡æœ€è¿‘ 5 æ¡æ—¥å¿—ä¸­æ˜¯å¦æœ‰é”™è¯¯ã€‚

---

## ğŸ”§ æµ‹è¯•è„šæœ¬ä½¿ç”¨è¯´æ˜

### 1. å®Œæ•´éƒ¨ç½²è„šæœ¬ (full-deploy.sh)

**åŠŸèƒ½ï¼š**
- è‡ªåŠ¨ç”Ÿæˆ SSH å¯†é’¥å¯¹
- é…ç½® SSH å®¢æˆ·ç«¯
- å¤åˆ¶å…¬é’¥åˆ°è¿œç¨‹æœåŠ¡å™¨
- æ£€æŸ¥æœåŠ¡å™¨ç¯å¢ƒ
- æœ¬åœ°ç¼–è¯‘é¡¹ç›®
- åŒæ­¥æ–‡ä»¶åˆ°æœåŠ¡å™¨
- å¯åŠ¨æ‰€æœ‰æœåŠ¡

**ç”¨æ³•ï¼š**
```bash
bash full-deploy.sh [user@host]
```

**é¦–æ¬¡è¿è¡Œéœ€è¦è¾“å…¥ä¸€æ¬¡å¯†ç ã€‚**

### 2. é›†æˆæµ‹è¯•è„šæœ¬ (run-integration-tests.sh)

**åŠŸèƒ½ï¼š**
- 6 ç»„æµ‹è¯•ï¼Œå…±çº¦ 20+ ä¸ªæµ‹è¯•ç”¨ä¾‹
- è‡ªåŠ¨éªŒè¯åŸºç¡€è®¾æ–½ã€æœåŠ¡å¥åº·ã€API åŠŸèƒ½
- è¾“å‡ºè¯¦ç»†æµ‹è¯•æŠ¥å‘Š
- å¤±è´¥æ—¶æä¾›ä¿®å¤å»ºè®®

**ç”¨æ³•ï¼š**
```bash
bash run-integration-tests.sh [user@host]
```

**æµ‹è¯•ç»“æœç¤ºä¾‹ï¼š**
```
========================================
ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»
========================================

æµ‹è¯•æ—¶é—´: 2025-02-05 14:30:00
æ€»æµ‹è¯•æ•°: 20
é€šè¿‡: 20
å¤±è´¥: 0

========================================
âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
========================================
```

### 3. ç¯å¢ƒæ£€æŸ¥è„šæœ¬ (check-remote.sh)

**åŠŸèƒ½ï¼š**
- æ£€æŸ¥ç³»ç»Ÿä¿¡æ¯
- æ£€æŸ¥ Docker/Compose/Git ç‰ˆæœ¬
- æ£€æŸ¥ç«¯å£å ç”¨
- æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€

**ç”¨æ³•ï¼š**
```bash
bash check-remote.sh [user@host]
```

---

## ğŸ¤– AI åŠ©æ‰‹ä½¿ç”¨æŒ‡å—

å½“ AI åŠ©æ‰‹éœ€è¦æ‰§è¡Œæµ‹è¯•æ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### æ­¥éª¤ 1ï¼šç¡®è®¤æœåŠ¡å™¨ä¿¡æ¯

```
æœåŠ¡å™¨åœ°å€: ubuntu@129.226.60.225
```

### æ­¥éª¤ 2ï¼šæ‰§è¡Œæµ‹è¯•å‘½ä»¤

```bash
cd D:/dev/claudecode/search-platform-spec/deployments
bash run-integration-tests.sh ubuntu@129.226.60.225
```

### æ­¥éª¤ 3ï¼šåˆ†ææµ‹è¯•ç»“æœ

- **å…¨éƒ¨é€šè¿‡** â†’ ç³»ç»Ÿå¥åº·ï¼Œå¯ä»¥ç»§ç»­å¼€å‘
- **éƒ¨åˆ†å¤±è´¥** â†’ æ ¹æ®å¤±è´¥ä¿¡æ¯ä¿®å¤é—®é¢˜
- **è¿æ¥å¤±è´¥** â†’ æ£€æŸ¥ç½‘ç»œã€SSH å¯†é’¥

---

## ğŸ“Š æµ‹è¯•ç»“æœåˆ¤æ–­æ ‡å‡†

### å¥åº·æ ‡å‡†

- âœ… æ‰€æœ‰ 6 ç»„æµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… å®¹å™¨çŠ¶æ€å…¨éƒ¨ä¸º `Up`
- âœ… å¥åº·æ£€æŸ¥å…¨éƒ¨è¿”å› `UP`
- âœ… æ— é”™è¯¯æ—¥å¿—

### è­¦å‘Šæ ‡å‡†

- âš ï¸ éƒ¨åˆ†å®¹å™¨é‡å¯ä¸­
- âš ï¸ èµ„æºä½¿ç”¨ç‡ > 80%
- âš ï¸ æœ‰å°‘é‡è­¦å‘Šæ—¥å¿—

### å¼‚å¸¸æ ‡å‡†

- âŒ ä»»ä½•å®¹å™¨æœªå¯åŠ¨
- âŒ å¥åº·æ£€æŸ¥å¤±è´¥
- âŒ ç«¯å£æ— æ³•è®¿é—®
- âŒ æœ‰å¤§é‡é”™è¯¯æ—¥å¿—

---

## ğŸ” æ•…éšœæ’æŸ¥æµç¨‹

### 1. SSH è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ç½‘ç»œ
ping 129.226.60.225

# æ£€æŸ¥ SSH ç«¯å£
telnet 129.226.60.225 22

# é‡æ–°é…ç½® SSH å¯†é’¥
bash setup-ssh-key.sh ubuntu@129.226.60.225
```

### 2. å®¹å™¨æœªå¯åŠ¨

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
ssh ubuntu@129.226.60.225 'cd ~/search-platform-spec/deployments/docker && docker compose ps -a'

# æŸ¥çœ‹æ—¥å¿—
ssh ubuntu@129.226.60.225 'cd ~/search-platform-spec/deployments/docker && docker compose logs'

# é‡å¯æœåŠ¡
ssh ubuntu@129.226.60.225 'cd ~/search-platform-spec/deployments/docker && docker compose restart'
```

### 3. å¥åº·æ£€æŸ¥å¤±è´¥

```bash
# æ£€æŸ¥å…·ä½“æœåŠ¡æ—¥å¿—
ssh ubuntu@129.226.60.225 'docker logs config-admin --tail 50'

# è¿›å…¥å®¹å™¨æ£€æŸ¥
ssh ubuntu@129.226.60.225 'docker exec -it config-admin bash'
```

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šå­˜å‚¨

æµ‹è¯•æ—¥å¿—ä¿å­˜åœ¨ï¼š

| ç±»å‹ | è·¯å¾„ |
|------|------|
| éƒ¨ç½²æ—¥å¿— | `deployments/logs/deploy_*.log` |
| æµ‹è¯•æŠ¥å‘Š | `deployments/logs/test_report_*.txt` |
| é”™è¯¯æ—¥å¿— | `deployments/logs/error_*.log` |

---

## ğŸ”„ æŒç»­é›†æˆå»ºè®®

### å®šæœŸæµ‹è¯•

```bash
# æ¯æ—¥å¥åº·æ£€æŸ¥
0 9 * * * bash /path/to/run-integration-tests.sh ubuntu@129.226.60.225

# æ¯å‘¨å®Œæ•´éƒ¨ç½²æµ‹è¯•
0 2 * * 0 bash /path/to/full-deploy.sh ubuntu@129.226.60.225
```

### ç›‘æ§å‘Šè­¦

- Prometheus æŒç»­æ”¶é›†æŒ‡æ ‡
- Grafana å±•ç¤ºç›‘æ§é¢æ¿
- å…³é”®æŒ‡æ ‡å¼‚å¸¸æ—¶å‘é€å‘Šè­¦

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è·¯å¾„ |
|------|------|
| éƒ¨ç½²å¿«é€Ÿå…¥é—¨ | `deployments/QUICKSTART.md` |
| è¿œç¨‹éƒ¨ç½²æŒ‡å— | `deployments/REMOTE_DEPLOYMENT.md` |
| SSH å¯†é’¥é…ç½® | `docs/deployment/SSH_KEY_SETUP.md` |
| é¡¹ç›®è®¾è®¡æ–‡æ¡£ | `docs/plans/2025-02-04-enterprise-search-platform-design.md` |
